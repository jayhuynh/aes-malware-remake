//
// Created by JAY HUYNH on 11/10/2019.
//

#include "AESCore.h"

void AESCore::addRoundKey(unsigned char *tempMessage, unsigned char *roundKey) {
    for (int i = 0; i < 16; i++)
    {
        tempMessage[i] ^= roundKey[i];
    }
}

void AESCore::subBytes(unsigned char *tempMessage) {
    for (int i = 0; i < 16; i++)
    {
        tempMessage[i] = AESTables::s_box[tempMessage[i]];
    }
}

void AESCore::IV_subBytes(unsigned char *tempMessage) {
    for (int i = 0; i < 16; i++)
    {
        tempMessage[i] = AESTables::IV_s_box[tempMessage[i]];
    }
}

void AESCore::shiftRows(unsigned char *tempMessage) {
    unsigned char temp[16];

    temp[0] = tempMessage[0];
    temp[1] = tempMessage[5];
    temp[2] = tempMessage[10];
    temp[3] = tempMessage[15];

    temp[4] = tempMessage[4];
    temp[5] = tempMessage[9];
    temp[6] = tempMessage[14];
    temp[7] = tempMessage[3];

    temp[8] = tempMessage[8];
    temp[9] = tempMessage[13];
    temp[10] = tempMessage[2];
    temp[11] = tempMessage[7];

    temp[12] = tempMessage[12];
    temp[13] = tempMessage[1];
    temp[14] = tempMessage[6];
    temp[15] = tempMessage[11];

    for (int i = 0; i < 16; i++)
    {
        tempMessage[i] = temp[i];
    }
}

void AESCore::IV_shiftRows(unsigned char *tempMessage) {
    unsigned char temp[16];

    temp[0] = tempMessage[0];
    temp[1] = tempMessage[13];
    temp[2] = tempMessage[10];
    temp[3] = tempMessage[7];

    temp[4] = tempMessage[4];
    temp[5] = tempMessage[1];
    temp[6] = tempMessage[14];
    temp[7] = tempMessage[11];

    temp[8] = tempMessage[8];
    temp[9] = tempMessage[5];
    temp[10] = tempMessage[2];
    temp[11] = tempMessage[15];

    temp[12] = tempMessage[12];
    temp[13] = tempMessage[9];
    temp[14] = tempMessage[6];
    temp[15] = tempMessage[3];

    for (int i = 0; i < 16; i++)
    {
        tempMessage[i] = temp[i];
    }
}

void AESCore::mixColumns(unsigned char *tempMessage) {
    unsigned char temp[16];
    
    temp[0] = (unsigned char)(AESTables::mul2[tempMessage[0]] ^ AESTables::mul3[tempMessage[1]] ^ tempMessage[2] ^ tempMessage[3]);
    temp[1] = (unsigned char)(tempMessage[0] ^ AESTables::mul2[tempMessage[1]] ^ AESTables::mul3[tempMessage[2]] ^ tempMessage[3]);
    temp[2] = (unsigned char)(tempMessage[0] ^ tempMessage[1] ^ AESTables::mul2[tempMessage[2]] ^ AESTables::mul3[tempMessage[3]]);
    temp[3] = (unsigned char)(AESTables::mul3[tempMessage[0]] ^ tempMessage[1] ^ tempMessage[2] ^ AESTables::mul2[tempMessage[3]]);

    temp[4] = (unsigned char)(AESTables::mul2[tempMessage[4]] ^ AESTables::mul3[tempMessage[5]] ^ tempMessage[6] ^ tempMessage[7]);
    temp[5] = (unsigned char)(tempMessage[4] ^ AESTables::mul2[tempMessage[5]] ^ AESTables::mul3[tempMessage[6]] ^ tempMessage[7]);
    temp[6] = (unsigned char)(tempMessage[4] ^ tempMessage[5] ^ AESTables::mul2[tempMessage[6]] ^ AESTables::mul3[tempMessage[7]]);
    temp[7] = (unsigned char)(AESTables::mul3[tempMessage[4]] ^ tempMessage[5] ^ tempMessage[6] ^ AESTables::mul2[tempMessage[7]]);

    temp[8] = (unsigned char)(AESTables::mul2[tempMessage[8]] ^ AESTables::mul3[tempMessage[9]] ^ tempMessage[10] ^ tempMessage[11]);
    temp[9] = (unsigned char)(tempMessage[8] ^ AESTables::mul2[tempMessage[9]] ^ AESTables::mul3[tempMessage[10]] ^ tempMessage[11]);
    temp[10] = (unsigned char)(tempMessage[8] ^ tempMessage[9] ^ AESTables::mul2[tempMessage[10]] ^ AESTables::mul3[tempMessage[11]]);
    temp[11] = (unsigned char)(AESTables::mul3[tempMessage[8]] ^ tempMessage[9] ^ tempMessage[10] ^ AESTables::mul2[tempMessage[11]]);

    temp[12] = (unsigned char)(AESTables::mul2[tempMessage[12]] ^ AESTables::mul3[tempMessage[13]] ^ tempMessage[14] ^ tempMessage[15]);
    temp[13] = (unsigned char)(tempMessage[12] ^ AESTables::mul2[tempMessage[13]] ^ AESTables::mul3[tempMessage[14]] ^ tempMessage[15]);
    temp[14] = (unsigned char)(tempMessage[12] ^ tempMessage[13] ^ AESTables::mul2[tempMessage[14]] ^ AESTables::mul3[tempMessage[15]]);
    temp[15] = (unsigned char)(AESTables::mul3[tempMessage[12]] ^ tempMessage[13] ^ tempMessage[14] ^ AESTables::mul2[tempMessage[15]]);

    for (int i = 0; i < 16; i++)
    {
        tempMessage[i] = temp[i];
    }
}

void AESCore::IV_mixColumns(unsigned char *tempMessage) {
    unsigned char temp[16];

    temp[0] = (unsigned char)(AESTables::mulE[tempMessage[0]] ^ AESTables::mulB[tempMessage[1]] ^ AESTables::mulD[tempMessage[2]] ^ AESTables::mul9[tempMessage[3]]);
    temp[1] = (unsigned char)(AESTables::mul9[tempMessage[0]] ^ AESTables::mulE[tempMessage[1]] ^ AESTables::mulB[tempMessage[2]] ^ AESTables::mulD[tempMessage[3]]);
    temp[2] = (unsigned char)(AESTables::mulD[tempMessage[0]] ^ AESTables::mul9[tempMessage[1]] ^ AESTables::mulE[tempMessage[2]] ^ AESTables::mulB[tempMessage[3]]);
    temp[3] = (unsigned char)(AESTables::mulB[tempMessage[0]] ^ AESTables::mulD[tempMessage[1]] ^ AESTables::mul9[tempMessage[2]] ^ AESTables::mulE[tempMessage[3]]);

    temp[4] = (unsigned char)(AESTables::mulE[tempMessage[4]] ^ AESTables::mulB[tempMessage[5]] ^ AESTables::mulD[tempMessage[6]] ^ AESTables::mul9[tempMessage[7]]);
    temp[5] = (unsigned char)(AESTables::mul9[tempMessage[4]] ^ AESTables::mulE[tempMessage[5]] ^ AESTables::mulB[tempMessage[6]] ^ AESTables::mulD[tempMessage[7]]);
    temp[6] = (unsigned char)(AESTables::mulD[tempMessage[4]] ^ AESTables::mul9[tempMessage[5]] ^ AESTables::mulE[tempMessage[6]] ^ AESTables::mulB[tempMessage[7]]);
    temp[7] = (unsigned char)(AESTables::mulB[tempMessage[4]] ^ AESTables::mulD[tempMessage[5]] ^ AESTables::mul9[tempMessage[6]] ^ AESTables::mulE[tempMessage[7]]);

    temp[8] = (unsigned char)(AESTables::mulE[tempMessage[8]] ^ AESTables::mulB[tempMessage[9]] ^ AESTables::mulD[tempMessage[10]] ^ AESTables::mul9[tempMessage[11]]);
    temp[9] = (unsigned char)(AESTables::mul9[tempMessage[8]] ^ AESTables::mulE[tempMessage[9]] ^ AESTables::mulB[tempMessage[10]] ^ AESTables::mulD[tempMessage[11]]);
    temp[10] = (unsigned char)(AESTables::mulD[tempMessage[8]] ^ AESTables::mul9[tempMessage[9]] ^ AESTables::mulE[tempMessage[10]] ^ AESTables::mulB[tempMessage[11]]);
    temp[11] = (unsigned char)(AESTables::mulB[tempMessage[8]] ^ AESTables::mulD[tempMessage[9]] ^ AESTables::mul9[tempMessage[10]] ^ AESTables::mulE[tempMessage[11]]);

    temp[12] = (unsigned char)(AESTables::mulE[tempMessage[12]] ^ AESTables::mulB[tempMessage[13]] ^ AESTables::mulD[tempMessage[14]] ^ AESTables::mul9[tempMessage[15]]);
    temp[13] = (unsigned char)(AESTables::mul9[tempMessage[12]] ^ AESTables::mulE[tempMessage[13]] ^ AESTables::mulB[tempMessage[14]] ^ AESTables::mulD[tempMessage[15]]);
    temp[14] = (unsigned char)(AESTables::mulD[tempMessage[12]] ^ AESTables::mul9[tempMessage[13]] ^ AESTables::mulE[tempMessage[14]] ^ AESTables::mulB[tempMessage[15]]);
    temp[15] = (unsigned char)(AESTables::mulB[tempMessage[12]] ^ AESTables::mulD[tempMessage[13]] ^ AESTables::mul9[tempMessage[14]] ^ AESTables::mulE[tempMessage[15]]);

    for (int i = 0; i < 16; i++)
    {
        tempMessage[i] = temp[i];
    }
}